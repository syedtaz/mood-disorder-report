# Univariate Logistic Regression

```{r, results='hide', include = FALSE}
univariate_lr <- function(gender, disease) {
  print(disease)
  df <- data.frame(Variable_Name=character(), Odds_Ratio=numeric(), Conf_25=numeric(), Conf_75=numeric(), P_Value=numeric())
  f_path = paste(disease,'/split/',gender,sep='')
  files <- list.files(path=f_path, pattern="*.csv", full.names=TRUE, recursive=FALSE)

  for (f in files) {
    data <- read.csv(file =f)
    names(data)[ncol(data)] <- 'y'
    res = glm(y ~ .,data=data,family=binomial())
    trm <- attr(res$terms, "term.labels")
    for (i in (seq(2,dim(data)[2],by=1))) {
      res_vec <- c(trm[i-1], exp(summary(res)$coef[i,][1]), exp(confint(res)[i,]), summary(res)$coef[i,][4])
      df[nrow(df) + 1,] = res_vec
    }
    
  }
  adjusted <- p.adjust(df[, c('P_Value')], method="BH")
  df$Adjusted_P = adjusted
  
  df <- df[order(df$P_Value),]
  df
}
```

```{r, results='hide', include = FALSE}
top_univariate_lr <- function(disease, n=10) {
  if (n == 10) {
    filename = '10feature_dataset.csv'
  } else {
    filename = '20feature_dataset.csv'
  }
  f_path = paste(disease,'/top/',filename,sep='')
  data <- read.csv(f_path)
  
  df <- data.frame(Variable_Name=character(), Odds_Ratio=numeric(), Conf_25=numeric(), Conf_75=numeric(), P_Value=numeric())
  names(data)[ncol(data)] <- 'y'
  for (i in 1:dim(data)[2]) {
    res = glm(y ~ .,data=subset(data, select=c(i, ncol(data))),family=binomial())
    a <- c( colnames(data)[i], exp(summary(res)$coef[2,][1]), exp(confint(res)[2,]), summary(res)$coef[2,][4])
    df[nrow(df) + 1,] = a
  }
  adjusted <- p.adjust(df[, c('P_Value')], method="BH")
  df$Adjusted_P = adjusted
  df <- df[order(df$P_Value),]
  
  df
}
```


```{r, include = FALSE}
create_table <- function(dataframe, label) {
  kableExtra::kable_styling(knitr::kable(dataframe[dataframe$P_Value <= 0.05,], booktabs = TRUE, 
      caption = label), font_size = 10)
}
```

## BDI

### One-Way

For the one-way analysis — we see CRY2AA appear in the univariate analysis for the combined genders as well as the male and female cases. SOCIO and CRY2GG also appear for the combined case and the female case, whereas GENDER is significant in the combined case as well.


```{r, results='hide', include = FALSE}
setwd("/Users/tazmilur/Research/mood-disorder-prediction/statistical-analysis/analysis/")
BDI1way_gendered <- univariate_lr('gendered','BDI1way')
BDI1way_male <- univariate_lr('male','BDI1way')
BDI1way_female <- univariate_lr('female','BDI1way')
```

```{r, echo=FALSE}
create_table(BDI1way_gendered, label='Potentially Significant Univariate LR Results from 1-way BDI with combined genders.')
```

```{r, echo=FALSE}
create_table(BDI1way_male, label='Potentially Significant Univariate LR Results from 1-way BDI with males.')
```

```{r, echo=FALSE}
create_table(BDI1way_female, label='Potentially Significant Univariate LR Results from 1-way BDI with females.')
```


### Two-Way

```{r, results='hide', include = FALSE}
setwd("/Users/tazmilur/Research/mood-disorder-prediction/statistical-analysis/analysis/")
BDI2way_gendered <- univariate_lr('gendered','BDI2way')
BDI2way_male <- univariate_lr('male','BDI2way')
BDI2way_female <- univariate_lr('female','BDI2way')
```

The two-way univariate analysis has a lot more genes that pop up as a potentially significant case. Note that CRY2AA appears as significant in almost all of the cases. A huge proportion of the features do have CRY2 as a component of their genetic combination. Clinical features such as GENDER and SOCIO are also likely candidates for some of these datasets. Note that none of the features are significant after adjustment, which may be due to the large number of multiple tests we had to do. 


```{r, echo=FALSE}
create_table(BDI2way_gendered, label='Potentially Significant Univariate LR Results from 2-way BDI with combined genders.')
```

```{r, echo=FALSE}
create_table(BDI2way_male, label='Potentially Significant Univariate LR Results from 2-way BDI with males.')
```

```{r, echo=FALSE}
create_table(BDI2way_female, label='Potentially Significant Univariate LR Results from 2-way BDI with females.')
```


### Top Features

From the top-10 and top-20 features collected from upto 5-way interactions, only GENDER is significant before and after adjustment in the top-10 case. However, there are a couple of more features that may be significant or interesting.

```{r, results='hide', include = FALSE}
setwd("/Users/tazmilur/Research/mood-disorder-prediction/statistical-analysis/analysis/")
univariate_top_BDI_10 <- top_univariate_lr('BDI5way')
univariate_top_BDI_20 <- top_univariate_lr('BDI5way',n=20)
```

```{r, echo=FALSE}
create_table(univariate_top_BDI_10, label=' Potentially Significant Univariate LR Results from top-10 feature dataset.')
```

```{r, echo=FALSE}
create_table(univariate_top_BDI_20 , label=' Potentially Significant Univariate LR Results from top-20 feature dataset.')
```


## MEQ

For both the 1-way and 2-way cases, only AGE is significant for all variations of the dataset based on gender before adjustment (and after too, depending on the dataset). For the top-10 and top-20 datasets as well, AGE is the only factor that is significant before and after adjustment. 

### One-Way

```{r, results='hide', include = FALSE}
setwd("/Users/tazmilur/Research/mood-disorder-prediction/statistical-analysis/analysis/")
MEQ1way_gendered <- univariate_lr('gendered','MEQ1way')
MEQ1way_male <- univariate_lr('male','MEQ1way')
MEQ1way_female <- univariate_lr('female','MEQ1way')
```

```{r, echo=FALSE}
create_table(MEQ1way_gendered,label='Potentially Significant Univariate LR Results from 1-way MEQ with combined genders.')
```

```{r, echo=FALSE}
create_table(MEQ1way_male,label='Potentially Significant Univariate LR Results from 1-way MEQ with males.')
```

```{r, echo=FALSE}
create_table(MEQ1way_female,label='Potentially Significant Univariate LR Results from 1-way MEQ with females.')
```

### Two-Way

AGE is the only feature that remains consistent: depending on your gender split for the two-way dataset you can end up with a mix of features.

```{r, results='hide', include = FALSE}
setwd("/Users/tazmilur/Research/mood-disorder-prediction/statistical-analysis/analysis/")
MEQ2way_gendered <- univariate_lr('gendered','MEQ2way')
MEQ2way_male <- univariate_lr('male','MEQ2way')
MEQ2way_female <- univariate_lr('female','MEQ2way')
```


```{r, echo=FALSE}
create_table(MEQ2way_gendered,label='Potentially Significant Univariate LR Results from 2-way MEQ with combined genders.')
```

```{r, echo=FALSE}
create_table(MEQ2way_male,label='Potentially Significant Univariate LR Results from 2-way MEQ with males.')
```

```{r, echo=FALSE}
create_table(MEQ2way_female,label='Potentially Significant Univariate LR Results from 2-way MEQ with females.')
```


### Top Features

```{r, results='hide', include = FALSE}
setwd("/Users/tazmilur/Research/mood-disorder-prediction/statistical-analysis/analysis/")
univariate_top_MEQ_10 <- top_univariate_lr('MEQ5way')
univariate_top_MEQ_20 <- top_univariate_lr('MEQ5way',n=20)
```

```{r, echo=FALSE}
create_table(univariate_top_MEQ_10, label=' Potentially Potentially Significant Univariate LR Results from top-10 feature dataset.')
```

```{r, echo=FALSE}
create_table(univariate_top_MEQ_20, label=' Potentially Potentially Significant Univariate LR Results from top-20 feature dataset.')
```


## STAI

### One-Way

For the 1-way analysis — in the combined and female cases AGE appears as a potentially significant feature; although it may lose this significance after adjustment. Note that CRY2AA appears for the combined and male case, but not the female.

```{r, results='hide', include = FALSE}
setwd("/Users/tazmilur/Research/mood-disorder-prediction/statistical-analysis/analysis/")
STAI1way_gendered <- univariate_lr('gendered','STAI1way')
STAI1way_male <- univariate_lr('male','STAI1way')
STAI1way_female <- univariate_lr('female','STAI1way')
```

```{r, echo=FALSE}
create_table(STAI1way_gendered,label='Potentially Significant Univariate LR Results from 1-way STAI with combined genders.')
```


```{r, echo=FALSE}
create_table(STAI1way_male,label='Potentially Significant Univariate LR Results from 1-way STAI with males.')
```


```{r, echo=FALSE}
create_table(STAI1way_female,label='Potentially Significant Univariate LR Results from 1-way STAI with females.')
```

### Two-Way

For the two-way analysis — there are a bunch of features that pop up for the combined case, however there is an increase in the number of significant features when moving to a split female dataset. Males, however, continue to remain inconsistent and show a slight decline in the number of features found to be potentially significant relative to the other datasets. However, none of the features in any of the cases remain significant after adjustment.

```{r, results='hide', include = FALSE}
setwd("/Users/tazmilur/Research/mood-disorder-prediction/statistical-analysis/analysis/")
STAI2way_gendered <- univariate_lr('gendered','STAI2way')
STAI2way_male <- univariate_lr('male','STAI2way')
STAI2way_female <- univariate_lr('female','STAI2way')
```


```{r, echo=FALSE}
create_table(STAI2way_gendered,label='Potentially Significant Univariate LR Results from 2-way STAI with combined genders.')
```

```{r, echo=FALSE}
create_table(STAI2way_male,label='Potentially Significant Univariate LR Results from 2-way STAI with males.')
```

```{r, echo=FALSE}
create_table(STAI2way_female,label='Potentially Significant Univariate LR Results from 2-way STAI with females.')
```

### Top Features

For the top-10 and top-20 datasets as well, AGE is the only factor that is significant before and after adjustment. 


```{r, results='hide', include = FALSE}
setwd("/Users/tazmilur/Research/mood-disorder-prediction/statistical-analysis/analysis/")
univariate_top_STAI_10 <- top_univariate_lr('STAI5way')
univariate_top_STAI_20 <- top_univariate_lr('STAI5way',n=20)
```

```{r, echo=FALSE}
create_table(univariate_top_STAI_10, label=' Potentially Potentially Significant Univariate LR Results from top-10 feature dataset.')
```

```{r, echo=FALSE}
create_table(univariate_top_STAI_20, label=' Potentially Potentially Significant Univariate LR Results from top-20 feature dataset.')
```


## Summary

Going from one-way to two-way usually results in a lot more features being found significant (except for MEQ, where the increase in number is not that high even if the p-value cutoff is set to 0.1): in the same vein, clinical features are almost always chosen and there are a few genes (for example, CRY2) present in almost all of the features found to be significant. For the top feature cases, only a single clinical feature remains significant before and after adjustment. The number of features vary from dataset to dataset, but male datasets tend to be more unstable and produce results that deviate from the female and combined cases.
